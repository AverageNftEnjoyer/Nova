# =============================================================================
# NovaOS V.14 Alpha — Environment Variables
# Copy this file to .env and fill in your values.
# Lines starting with # are comments and are ignored.
# =============================================================================

# =============================================================================
# SUPABASE (required — HUD auth, storage, integrations)
# =============================================================================
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key

# Browser-safe mirrors (must match above)
NEXT_PUBLIC_SUPABASE_URL=https://your-project-ref.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key

# =============================================================================
# SECURITY (required)
# =============================================================================
# 32-byte key encoded as base64 — used to encrypt stored API keys at rest.
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
NOVA_ENCRYPTION_KEY=

# Random secret for Gmail OAuth CSRF state validation.
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
NOVA_GMAIL_OAUTH_STATE_SECRET=

# =============================================================================
# LLM PROVIDERS (at least one required)
# =============================================================================
OPENAI_API_KEY=
ANTHROPIC_API_KEY=

# =============================================================================
# VOICE / TTS — Fish Audio
# =============================================================================
# Your Fish Audio API key (https://fish.audio)
FISH_API_KEY=

# Voice reference IDs from your Fish Audio account.
# REFERENCE_ID is the default/active voice Nova uses.
REFERENCE_ID=
PETER_ID=
MORD_ID=
ULTRON_ID=

# =============================================================================
# INTEGRATIONS (all optional — configure via the Integrations UI)
# =============================================================================

# Brave Search API (web search tool)
BRAVE_API_KEY=

# Telegram
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_ID=
TELEGRAM_CHAT_IDS=

# Discord
DISCORD_WEBHOOK_URL=
DISCORD_WEBHOOK_URLS=

# Google OAuth (Supabase Auth — sign in with Google)
# Create credentials at https://console.cloud.google.com → APIs & Services → Credentials
SUPABASE_AUTH_GOOGLE_CLIENT_ID=
SUPABASE_AUTH_GOOGLE_CLIENT_SECRET=

# Gmail OAuth (integration — read/send email via Nova)
NOVA_GMAIL_CLIENT_ID=
NOVA_GMAIL_CLIENT_SECRET=
NOVA_GMAIL_REDIRECT_URI=http://localhost:3000/api/integrations/gmail/callback

# =============================================================================
# APP CONFIG (optional — defaults shown)
# =============================================================================
NOVA_APP_URL=http://localhost:3000

# HUD launch mode: "start" (production build) or "dev" (Next.js dev server)
NOVA_HUD_MODE=start

# Your local timezone for agent date/time awareness (IANA format)
NOVA_USER_TIMEZONE=America/New_York

# Wake word fallback for voice activation (default: nova).
# Runtime will auto-switch wake detection to the user-configured assistant name
# (for example, assistant name "Lana" -> wake word "lana").
# Use these env values only as startup fallback/override defaults.
NOVA_WAKE_WORD=nova
NOVA_WAKE_WORD_VARIANTS=nova

# =============================================================================
# AGENT TUNABLES (optional — safe defaults built in)
# =============================================================================

# Allow agent to fall back to secondary LLM provider if primary fails
NOVA_ALLOW_PROVIDER_FALLBACK=0
# Routing arbitration preference when fallback mode is enabled:
# balanced | latency | cost | quality
NOVA_ROUTING_PREFERENCE=balanced
# Allow routing layer to override active provider when active is healthy (0/1).
NOVA_ROUTING_ALLOW_ACTIVE_OVERRIDE=0
# Optional CSV provider preference order hints (e.g. "openai,gemini").
NOVA_ROUTING_PREFERRED_PROVIDERS=

# Tool loop: max steps per agent turn (default: 6)
NOVA_TOOL_LOOP_MAX_STEPS=6

# HTTP/IP middleware limiter for /api/*
NOVA_HTTP_IP_RATE_LIMIT_WINDOW_MS=60000
NOVA_HTTP_IP_RATE_LIMIT_MAX=240
NOVA_HTTP_IP_RATE_LIMIT_GC_INTERVAL_MS=60000

# Per-user API limiter internals
NOVA_RATE_LIMIT_GC_INTERVAL_MS=60000

# Per-route user budgets
NOVA_RATE_LIMIT_CHAT_PER_MIN=20
NOVA_RATE_LIMIT_MISSION_BUILD_PER_MIN=8
NOVA_RATE_LIMIT_MISSION_SUGGEST_PER_MIN=10
NOVA_RATE_LIMIT_MISSION_TRIGGER_PER_MIN=5
NOVA_RATE_LIMIT_MISSION_TRIGGER_STREAM_PER_MIN=4
NOVA_RATE_LIMIT_INTEGRATION_PROBE_PER_MIN=18
NOVA_RATE_LIMIT_ACCOUNT_DELETE_PER_10M=3
NOVA_RATE_LIMIT_THREAD_MESSAGES_WRITE_PER_MIN=24
NOVA_RATE_LIMIT_NOVACHAT_POLL_PER_MIN=90

# WebSocket ingress limiter (runtime)
NOVA_WS_MAX_PAYLOAD_BYTES=262144
NOVA_WS_MESSAGE_RATE_LIMIT_WINDOW_MS=10000
NOVA_WS_MESSAGE_RATE_LIMIT_MAX=35
NOVA_WS_USER_MESSAGE_RATE_LIMIT_WINDOW_MS=10000
NOVA_WS_USER_MESSAGE_RATE_LIMIT_MAX=20
NOVA_WS_USER_RATE_LIMIT_GC_MS=60000

# Prompt budget controls
# Keep this many tokens reserved for model completion output.
NOVA_PROMPT_RESPONSE_RESERVE_TOKENS=1400
# Preferred history token budget (runtime scales this down when prompt context is heavy).
NOVA_PROMPT_HISTORY_TARGET_TOKENS=1400
# Minimum history tokens to keep when possible.
NOVA_PROMPT_MIN_HISTORY_TOKENS=220
# Max tokens allowed per optional context section (web preload, link context, memory recall).
NOVA_PROMPT_CONTEXT_SECTION_MAX_TOKENS=1000
# Enable verbose prompt budget logs (1=on, 0=off).
NOVA_PROMPT_BUDGET_DEBUG=0

# Mission quality guardrails
NOVA_MISSION_QUALITY_MIN_SCORE=46
NOVA_MISSION_QUALITY_MIN_WORDS=24
NOVA_MISSION_QUALITY_DEBUG=0

# Mission workflow AI prompt caps
NOVA_MISSION_AI_CONTEXT_MAX_CHARS=9000
NOVA_MISSION_AI_PROMPT_MAX_CHARS=11000

# Scheduler reliability controls
NOVA_SCHEDULER_TICK_MS=60000
NOVA_SCHEDULER_MAX_RUNS_PER_TICK=12
NOVA_SCHEDULER_MAX_RUNS_PER_USER_PER_TICK=4
NOVA_SCHEDULER_MAX_RETRIES_PER_RUN_KEY=3
NOVA_SCHEDULER_RETRY_BASE_MS=60000
NOVA_SCHEDULER_RETRY_MAX_MS=900000
NOVA_SCHEDULER_RUN_HISTORY_MAX_LINES=600

# Telegram delivery reliability controls
NOVA_TELEGRAM_SEND_TIMEOUT_MS=10000
NOVA_TELEGRAM_SEND_MAX_RETRIES=2
NOVA_TELEGRAM_SEND_RETRY_BASE_MS=700

# Discord delivery reliability controls
NOVA_DISCORD_SEND_TIMEOUT_MS=10000
NOVA_DISCORD_SEND_MAX_RETRIES=2
NOVA_DISCORD_SEND_RETRY_BASE_MS=700
NOVA_DISCORD_SEND_RETRY_JITTER_MS=250
NOVA_DISCORD_SEND_CONCURRENCY=5
NOVA_DISCORD_MAX_TARGETS=50
NOVA_DISCORD_RETRY_ENABLED=1
NOVA_DISCORD_SEND_DISABLED=0

# Mission skill snapshot controls (used for scheduled job isolation)
NOVA_MISSION_SKILL_SNAPSHOT_MAX_SKILLS=10
NOVA_MISSION_SKILL_SNAPSHOT_MAX_CHARS=3600
NOVA_MISSION_AI_SKILL_GUIDANCE_MAX_CHARS=2600

# Link understanding cache controls
NOVA_LINK_FETCH_CACHE_TTL_MS=600000
NOVA_LINK_FETCH_CACHE_MAX=256

# Memory relevance + compression controls
NOVA_MEMORY_RECALL_TOP_K=3
NOVA_MEMORY_RECALL_MAX_CHARS=2200
NOVA_MEMORY_RECALL_MAX_TOKENS=480
NOVA_MEMORY_MMR_LAMBDA=0.72
NOVA_MEMORY_MMR_SOURCE_PENALTY=0.12
NOVA_MEMORY_MMR_MAX_PER_SOURCE_SOFT=2
NOVA_MEMORY_DECAY_HALF_LIFE_DAYS=45
NOVA_MEMORY_DECAY_TEMPORAL_HALF_LIFE_DAYS=21
NOVA_MEMORY_DECAY_EVERGREEN_HALF_LIFE_DAYS=180
NOVA_MEMORY_DECAY_MIN_MULTIPLIER=0.35

# Execution approval mode: "ask" (prompt user) or "auto" (run without asking)
NOVA_EXEC_APPROVAL_MODE=ask
# Tool risk-policy gates
# Elevated tools include local mutation/exec categories.
NOVA_TOOL_ALLOW_ELEVATED=1
# Dangerous tools are blocked by default unless explicitly elevated.
NOVA_TOOL_ALLOW_DANGEROUS=0
# Optional CSV allowlists by tool name.
NOVA_TOOL_ELEVATED_ALLOWLIST=
NOVA_TOOL_DANGEROUS_ALLOWLIST=
# Capability isolation policy for plugin-style or scoped tool execution.
# When enabled, tool capabilities must be explicitly allowed.
NOVA_TOOL_CAPABILITY_ENFORCE=0
# CSV capability grants. Examples:
# filesystem.read,filesystem.write,network.search,network.fetch,process.exec,memory.read
# Supports wildcard namespaces (e.g. "network.*") and tool grants ("tool:web_search").
NOVA_TOOL_CAPABILITY_ALLOWLIST=
# CSV denylist rules with same syntax as allowlist.
NOVA_TOOL_CAPABILITY_DENYLIST=

# Session limits
NOVA_SESSION_MAX_TURNS=20
NOVA_SESSION_IDLE_MINUTES=120

# Disable system metrics collection (set to 1 to disable)
NOVA_METRICS_DISABLED=0
